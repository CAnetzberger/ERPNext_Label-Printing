{"version":3,"file":"label_printing.min.js","sources":["../../../../apps/label_printing/label_printing/public/js/label_printing_dialog.vue?rollup-plugin-vue=script.js","../../../../apps/label_printing/label_printing/public/js/label_printing_dialog.vue","../../../../apps/label_printing/label_printing/public/js/label_printing_desk.js"],"sourcesContent":["//\n//\n//\n//\n//\n//\n//\n//\n\nexport default {\n  name: \"LabelPrintingDialog\",\n  props: [],\n  methods: {},\n};\n","<template>\n  <li class=\"nav-item\">\n    <a class=\"nav-link label-printing-icon text-muted\">\n      <i class=\"fa fa-tag fa-lg\" aria-hidden=\"true\"></i>\n    </a>\n  </li>\n</template>\n\n<script>\nexport default {\n  name: \"LabelPrintingDialog\",\n  props: [],\n  methods: {},\n};\n</script>\n\n<style>\n</style>","import LabelPrintingDialog from \"./label_printing_dialog.vue\";\n\n$(document).ready(function () {\n    $(\".dropdown-notifications\").after('<li id=\"labels-toolbar\" class=\"nav-item\"><a class=\"nav-link label-printing-icon text-muted\"><i class=\"fa fa-tag fa-lg\" aria-hidden=\"true\"></i></a></li>');\n    $(\"#labels-toolbar\").click(function(page) {\n    setupLabelsDialog(page);\n  });\n\n});\n\n\n\nfunction setupLabelsDialog(page) {\n  let cur_frm = page.view.cur_frm\n\n  let fields = {\n    doctype: '',\n    docname: ' ',\n    item_code: '',\n    item_name: '',\n    delivery_date: '',\n    customer: '',\n    batch: '',\n    information: '',\n    total_amount: 0,\n    labels: [{\n      qty_per_label: 0,\n      is_warehouse: 0,\n      information: '',\n    }],\n    preview: __('Click \"Render Preview\"')\n  };\n\n\n  if (cur_frm !== null) {\n    if (cur_frm.doctype === \"Work Order\" || cur_frm.doctype === \"Item\") {\n      if (cur_frm.docname) {\n        fields.doctype = cur_frm.doctype\n        fields.docname = cur_frm.docname\n      }\n    }\n  }\n\n  let d = new frappe.ui.Dialog({\n    title: __(\"Print Labels\"),\n    fields: [{\n        label: __(\"Reference Doctype\"),\n        options: ['Work Order', 'Item'],\n        fieldname: 'doctype',\n        fieldtype: 'Select',\n        default: fields.doctype,\n      },\n      {\n        label: __(\"Get data\"),\n        fieldname: 'get_data',\n        fieldtype: 'Button',\n        click: () => {\n\t\t\t\t\t\t\thandleDataFetch()\n\t\t\t\t\t\t}\n      },\n      {\n        fieldtype: 'Column Break'\n      },\n      {\n        label: __(\"Reference Docname\"),\n        fieldname: 'docname',\n        fieldtype: 'Dynamic Link',\n        options: 'doctype',\n      },\n      {\n        fieldtype: 'Section Break',\n        label: __('Information')\n      },\n      {\n        label: __(\"Item Code\"),\n        fieldname: 'item_code',\n        fieldtype: 'Data'\n      },\n      {\n        label: __(\"Item Name\"),\n        fieldname: 'item_name',\n        fieldtype: 'Data'\n      },\n      {\n        label: __(\"Delivery Date\"),\n        fieldname: 'delivery_date',\n        fieldtype: 'Date'\n      },\n      {\n        fieldtype: 'Column Break'\n      },\n      {\n        label: __(\"Customer\"),\n        fieldname: 'customer',\n        fieldtype: 'Data'\n      },\n      {\n        label: __(\"Batch\"),\n        fieldname: 'batch',\n        fieldtype: 'Data'\n      },\n      {\n        fieldtype: 'Section Break',\n        label: __('Labels')\n      },\n      {\n        fieldname: \"labels\",\n        fieldtype: \"Table\",\n        cannot_add_rows: false,\n        in_place_edit: true,\n        data: fields.labels,\n        get_data: () => {\n          return fields.labels;\n        },\n        fields: [{\n            fieldtype: 'Int',\n            fieldname: \"item_qty\",\n            in_list_view: 1,\n            label: __('Item Qty')\n          },\n          {\n            label: __(\"Label Qty\"),\n            fieldname: 'label_qty',\n            in_list_view: 1,\n            fieldtype: 'Int'\n          },\n        ]\n      },\n    ],\n    primary_action_label: 'Print',\n    primary_action(values) {\n      fields = values\n\n      frappe.call({\n        method: \"label_printing.label_printing.api.create_labels\",\n        args: {\n          values: fields\n        },\n        callback: function(r) {\n          if (r.message === 200) {\n            frappe.show_alert(\"Label printing successful\", 5);\n          }\n        },\n      });\n\n      d.hide();\n    }\n  });\n  handleDataFetch();\n\n  d.show();\n  \n\n  // handle dpctype change\n  d.fields_dict.doctype.$input.on('change', function() {\n    d.fields_dict.docname.refresh();\n  });\n\n  function handleDataFetch() {\n    fields = d.get_values()\n    if (fields.doctype && fields.docname) {\n      let doc = get_doc(fields.doctype, fields.docname)\n\n      if (fields.doctype === \"Work Order\") {\n        let item = get_doc(\"Item\", doc.production_item)\n        fields.item_code = item.item_code\n        fields.item_name = item.item_name\n        fields.delivery_date = doc.expected_delivery_date\n\n        if (item.associated_company) {\n          let customer = get_doc(\"Customer\", item.associated_company)\n          if (customer.short_name) {\n            fields.customer = customer.short_name\n          } else {\n            fields.customer = item.associated_company\n          }\n        }\n\n        fields.total_amount = doc.qty\n        fields.labels[0].qty_per_label = doc.qty\n        d.fields_dict.labels.refresh();\n\n      } else if (fields.doctype === \"Item\") {\n        let item = get_doc(\"Item\", doc.item_code)\n\n        fields.item_code = doc.item_code\n        fields.item_name = doc.item_name\n\n        if (item.associated_company) {\n          let customer = get_doc(\"Customer\", doc.associated_company)\n          if (customer.short_name) {\n            fields.customer = customer.short_name\n          } else {\n            fields.customer = doc.associated_company\n          }\n        }\n      }\n\n      d.set_values(fields)\n    }\n  }\n\n}\n\nfunction get_doc(doctype, docname) {\n  let res;\n  frappe.call({\n    method: \"frappe.client.get\",\n    async: false,\n    args: {\n      doctype: doctype,\n      name: docname,\n    },\n    callback(r) {\n      if (r.message) {\n        res = r.message\n      }\n    }\n  });\n  return res;\n}"],"names":["const","let","item","customer"],"mappings":"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"}